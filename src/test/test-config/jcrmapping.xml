<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE graffito-jcr PUBLIC "-//The Apache Software Foundation//DTD Repository//EN" "./src/dtd/graffito-jcr-mapping.dtd">
<graffito-jcr>
    
  

	<!--
		The following classes are used to test object associations
		A has an assocition (1..1) with B (field b) => B is mapped as subnode in A
		A has a collection of C (field "collection" ) => there are n subnodes used to map the "C" collection 
		
	-->
	<class-descriptor
		className="org.apache.portals.graffito.jcr.testmodel.A"
		jcrNodeType="nt:unstructured" jcrMixinTypes="mix:lockable" >
		<!-- Field-descriptor is used to map simple attributes to jcr property -->
		<field-descriptor fieldName="path" path="true" />
		<field-descriptor fieldName="a1" jcrName="a1" />
		<field-descriptor fieldName="a2" jcrName="a2" />

		<!-- bean-descriptor is used to map a bean into subnode
			* The definition of the associated class has to be defined in this mapping file 
			* proxy="true" => use lazy laoding for this attribute b when retrieving A
		-->
		<bean-descriptor fieldName="b" jcrName="b" proxy="false" jcrNodeType="nt:unstructured"
        jcrAutoCreated="false" jcrMandatory="false" jcrOnParentVersion="IGNORE"
        jcrProtected="false" jcrSameNameSiblings="false" />

		<!-- 
			Use the default collection mapping stategy and the default collection type (can be a Vector, an ArrayList, a Collection or a List) 
			The default collection mapping strategy map a collection under an extra JCR node (specify by the jcrName).
			
		-->
		<collection-descriptor fieldName="collection" jcrName="collection" proxy="false"
        elementClassName="org.apache.portals.graffito.jcr.testmodel.C" jcrNodeType="graffito:C"
        jcrAutoCreated="false" jcrMandatory="false" jcrOnParentVersion="IGNORE"
        jcrProtected="false" jcrSameNameSiblings="false"/>
        
		<collection-descriptor fieldName="emptyCollection" jcrName="emptyCollection" proxy="false"
        elementClassName="org.apache.portals.graffito.jcr.testmodel.C" />
		
	</class-descriptor>

	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.B"  jcrNodeType="nt:unstructured" jcrSuperTypes="nt:base">
		<!-- Field-descriptor is used to map simple attributes to jcr property -->

		<field-descriptor fieldName="b1" jcrName="b1" jcrType="String" jcrAutoCreated="false" jcrMandatory="false"
        jcrOnParentVersion="IGNORE" jcrProtected="false" jcrMultiple="false" />
		
        <field-descriptor fieldName="b2" jcrName="b2" jcrType="String" jcrAutoCreated="false" jcrMandatory="false"
        jcrOnParentVersion="IGNORE" jcrProtected="false" jcrMultiple="false" />

	</class-descriptor>

	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.C" jcrNodeType="graffito:C" discriminator="false" >
		<!-- Field-descriptor is used to map simple attributes to jcr property -->
		<field-descriptor fieldName="id" jcrName="graffito:id" 	id="true" />
		<field-descriptor fieldName="name" jcrName="graffito:name" />
	</class-descriptor>


	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.Page" jcrNodeType="graffito:page" discriminator="false" >
		<field-descriptor fieldName="path" path="true" />
		<field-descriptor fieldName="title" jcrName="graffito:title" />
		<collection-descriptor fieldName="paragraphs" proxy="false" 
		                       elementClassName="org.apache.portals.graffito.jcr.testmodel.Paragraph" 
		                       collectionConverter="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.NTCollectionConverterImpl" />
	</class-descriptor>

	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.Paragraph" jcrNodeType="graffito:paragraph" discriminator="false" >
		<field-descriptor fieldName="path" path="true" />
		<field-descriptor fieldName="text" jcrName="graffito:text"/>
    	<bean-descriptor fieldName="page" jcrName="page" proxy="true" converter="org.apache.portals.graffito.jcr.persistence.beanconverter.impl.ParentBeanConverterImpl" />		
	</class-descriptor>


	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.hashmap.Main" jcrNodeType="nt:unstructured"  >
		<field-descriptor fieldName="path" path="true" />
		<field-descriptor fieldName="text" jcrName="text" />
		<collection-descriptor fieldName="elements"  proxy="false" 
		                       elementClassName="org.apache.portals.graffito.jcr.testmodel.hashmap.Element" 
		                       collectionConverter="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.NTCollectionConverterImpl" 
		                       collectionClassName="org.apache.portals.graffito.jcr.testmodel.hashmap.HashMapElement" />
		                       
	</class-descriptor>

	<class-descriptor className="org.apache.portals.graffito.jcr.testmodel.hashmap.Element" jcrNodeType="graffito:element" discriminator="false" >
		<field-descriptor fieldName="id" jcrName="graffito:id"  />
		<field-descriptor fieldName="text" jcrName="graffito:text" />
	</class-descriptor>
	
	
	<class-descriptor 	className="org.apache.portals.graffito.jcr.testmodel.Discriminator" 	jcrNodeType="graffito:discriminatorobject" discriminator="true" >
		<field-descriptor fieldName="path" path="true" />
		<field-descriptor fieldName="content" jcrName="graffito:content" />
	</class-descriptor>		


    <class-descriptor className="org.apache.portals.graffito.jcr.testmodel.Residual$ResidualProperties" jcrNodeType="nt:unstructured">
        <field-descriptor fieldName="path" path="true" />
        <collection-descriptor fieldName="elements" proxy="false" 
                               jcrName="value*"
                               elementClassName="java.lang.String"
                               collectionConverter="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.ResidualPropertiesCollectionConverterImpl" 
                               collectionClassName="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.ManagedHashMap" />
                               
    </class-descriptor>

    <class-descriptor className="org.apache.portals.graffito.jcr.testmodel.Residual$ResidualNodes" jcrNodeType="nt:unstructured">
        <field-descriptor fieldName="path" path="true" />
        <collection-descriptor fieldName="elements" proxy="false" 
                               jcrName="value*"
                               elementClassName="java.lang.Object"
                               collectionConverter="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.ResidualNodesCollectionConverterImpl" 
                               collectionClassName="org.apache.portals.graffito.jcr.persistence.collectionconverter.impl.ManagedHashMap" />
                               
    </class-descriptor>
</graffito-jcr>
 